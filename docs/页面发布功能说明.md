# 页面发布配置功能说明

## 功能概述

页面发布配置功能允许您创建多个不同的导航页面，每个页面可以：
- 设置不同的访问路径（routePath）
- 根据 `showPlatform` 字段自动过滤显示的导航项
- 控制是否显示管理后台入口

**核心原理**：`showPlatform` 和 `routePath` 是对应关系，访问不同路径时自动加载对应配置的导航数据。

## 使用步骤

### 1. 配置导航项的 showPlatform

在"导航管理"中，为每个导航项设置 `showPlatform` 字段：
- `0`: 开发运维主页使用
- `1`: 产品销售主页使用
- `null`: 在所有平台显示（不过滤）
- 可以自定义扩展更多平台类型（2、3、4...）

### 2. 创建页面发布配置

在管理后台的"页面发布"中创建配置：

**配置示例 1：开发运维主页**
- 配置名称：开发运维主页
- 路由路径：`/dev`
- 平台类型：`0`
- 隐藏管理入口：否
- 状态：启用

**配置示例 2：产品销售主页**
- 配置名称：产品销售主页
- 路由路径：`/cp`
- 平台类型：`1`
- 隐藏管理入口：是
- 状态：启用

**配置示例 3：公开展示页**
- 配置名称：公开展示页
- 路由路径：`/public`
- 平台类型：留空（不过滤）
- 隐藏管理入口：是
- 状态：启用

### 3. 访问不同的页面

访问不同路径时，系统会：
1. 根据路径查找对应的 SitePublish 配置
2. 根据配置的 showPlatform 字段，自动加载对应的导航项
3. 根据配置的 hideAdminEntry 字段，决定是否显示管理入口

**访问示例：**

```bash
# 访问首页（显示所有导航）
http://localhost:3000/

# 访问开发运维主页（只显示 showPlatform=0 的导航）
http://localhost:3000/dev

# 访问产品销售主页（只显示 showPlatform=1 的导航，隐藏管理入口）
http://localhost:3000/cp

# 访问公开展示页（显示所有导航，隐藏管理入口）
http://localhost:3000/public
```

## 工作流程

```
用户访问 /dev
    ↓
前端获取当前路径 = "/dev"
    ↓
调用 API: GET /api/sitePublish/route/dev
    ↓
获取配置: { name: "开发运维主页", showPlatform: 0, hideAdminEntry: false }
    ↓
调用 API: GET /api/navigation/lists/platform?showPlatform=0
    ↓
加载所有 showPlatform=0 的导航项
    ↓
显示页面，显示管理入口
```

## 技术实现

### 后端 API

**SitePublish 实体字段：**
- `id`: 主键
- `name`: 配置名称
- `routePath`: 路由路径（如：/site、/dev、/cp）**唯一**
- `showPlatform`: 显示的平台类型（0、1等，null表示不过滤）
- `hideAdminEntry`: 是否隐藏管理入口
- `enabled`: 是否启用
- `sort`: 排序值
- `description`: 描述说明

**API 端点：**

站点发布配置：
- `GET /api/sitePublish/lists` - 获取所有配置
- `GET /api/sitePublish/enabled` - 获取所有启用的配置
- `GET /api/sitePublish/route/{routePath}` - 根据路由路径获取配置
- `POST /api/sitePublish/append` - 新增配置
- `PUT /api/sitePublish/update` - 更新配置
- `DELETE /api/sitePublish/delete/{id}` - 删除配置

导航数据：
- `GET /api/navigation/lists` - 获取所有导航（不过滤）
- `GET /api/navigation/lists/platform?showPlatform=0` - 根据平台类型获取导航

### 前端实现

**使用 React Router：**
```typescript
<BrowserRouter>
  <Routes>
    <Route path="/admin" element={<AdminPage />} />
    <Route path="*" element={<NavigationPage />} />
  </Routes>
</BrowserRouter>
```

**动态加载逻辑：**
```typescript
const loadData = async () => {
  // 1. 获取当前路径
  const currentPath = location.pathname; // 如：/dev

  // 2. 根据路径获取站点配置
  let config: SitePublish | null = null;
  if (currentPath !== '/') {
    config = await sitePublishApi.getByRoutePath(currentPath);
  }

  // 3. 根据配置的 showPlatform 加载导航数据
  const navs =
    config?.showPlatform !== undefined
      ? await navApi.listByPlatform(config.showPlatform)
      : await navApi.list();

  // 4. 应用配置
  const hideAdmin = config?.hideAdminEntry ?? systemConfig.hideAdminEntry;
};
```

## 使用场景

### 1. 多团队使用

为不同团队创建专属的导航页面：

- **开发团队**：访问 `/dev` 查看开发工具、监控系统等
- **销售团队**：访问 `/sales` 查看 CRM、产品文档等
- **运维团队**：访问 `/ops` 查看服务器监控、日志系统等

### 2. 客户定制

为不同客户创建定制页面：

- **客户 A**：访问 `/client-a` 查看专属服务
- **客户 B**：访问 `/client-b` 查看专属服务

每个客户只能看到为其配置的导航项。

### 3. 公开展示

创建不带管理功能的公开页面：

- 访问 `/public` 展示产品和服务
- 隐藏管理入口，只显示必要的导航

### 4. 环境隔离

不同环境使用不同的导航：

- **开发环境**：showPlatform=0，显示测试工具
- **生产环境**：showPlatform=1，只显示生产系统

## 配置最佳实践

### 1. 路由命名规范

建议使用清晰的路由命名：
- `/dev` - 开发环境
- `/prod` - 生产环境
- `/team-{name}` - 团队页面
- `/client-{name}` - 客户页面

### 2. showPlatform 编号规范

建议按业务分类：
- `0-99`: 内部使用（开发、运维、测试等）
- `100-199`: 客户 A 系列
- `200-299`: 客户 B 系列
- `300-399`: 合作伙伴

### 3. 描述信息

每个配置都应添加清晰的描述，说明：
- 这个页面是给谁用的
- 包含哪些类型的导航
- 特殊说明

## 数据库表结构

### site_publish 表
```sql
CREATE TABLE site_publish (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL COMMENT '配置名称',
  route_path VARCHAR(100) NOT NULL UNIQUE COMMENT '路由路径',
  show_platform SMALLINT COMMENT '平台类型',
  hide_admin_entry BOOLEAN DEFAULT FALSE COMMENT '是否隐藏管理入口',
  enabled BOOLEAN DEFAULT TRUE COMMENT '是否启用',
  sort INT DEFAULT 1 COMMENT '排序值',
  description VARCHAR(500) COMMENT '描述说明',
  INDEX idx_route_path (route_path)
);
```

### nav_item 表新增字段
```sql
ALTER TABLE nav_item ADD COLUMN show_platform SMALLINT DEFAULT 0
  COMMENT '可显示的平台类型，null表示所有平台';
```

## 部署说明

### 开发环境

开发环境使用 React Router 的开发服务器即可，支持所有路由。

### 生产环境

需要配置服务器支持 SPA 路由：

**Nginx 配置示例：**
```nginx
server {
  listen 80;
  server_name your-domain.com;
  root /var/www/html;
  index index.html;

  # 支持所有路由
  location / {
    try_files $uri $uri/ /index.html;
  }

  # API 代理
  location /api {
    proxy_pass http://localhost:8080;
  }
}
```

## 注意事项

1. **路由路径唯一性**：每个 routePath 必须唯一，不能重复
2. **showPlatform 可以为 null**：表示该配置不过滤导航，显示所有
3. **导航项的 showPlatform**：可以为 null，表示在所有平台都显示
4. **管理入口优先级**：站点配置的 hideAdminEntry 优先于系统配置
5. **404 处理**：访问不存在的路径时，显示所有导航（默认行为）

## 常见问题

### Q1: 如何让某个导航在所有页面都显示？

A: 将该导航项的 `showPlatform` 设置为 `null`（留空）。

### Q2: 如何创建一个显示所有导航但隐藏管理入口的页面？

A: 创建配置时，`showPlatform` 留空，`hideAdminEntry` 设为 true。

### Q3: 访问未配置的路径会怎样？

A: 会显示所有导航项（相当于访问首页 `/`）。

### Q4: 可以有多个配置使用相同的 showPlatform 吗？

A: 可以！不同的 routePath 可以使用相同的 showPlatform，它们会显示相同的导航数据。

## 后续扩展建议

1. **自定义域名绑定**：为不同的配置绑定不同的域名
2. **权限控制**：为不同的页面设置访问权限（需要登录）
3. **主题定制**：每个页面可以有不同的主题风格和 Logo
4. **统计分析**：记录每个页面的访问量和使用情况
5. **多语言支持**：根据配置显示不同语言的导航
